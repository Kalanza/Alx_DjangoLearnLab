{% extends 'bookshelf/base.html' %}

{% block title %}{{ form_title }}{% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 0 auto;">
    <h1>{{ form_title }}</h1>
    
    <div class="security-notice" style="background: #e7f3ff; border: 1px solid #b8daff; padding: 15px; border-radius: 4px; margin: 20px 0;">
        <h4>ðŸ”’ Security Features Demonstrated:</h4>
        <ul style="margin: 10px 0 0 20px;">
            <li>âœ… CSRF Protection (automatic with Django forms)</li>
            <li>âœ… Input validation and sanitization</li>
            <li>âœ… XSS prevention through form cleaning</li>
            <li>âœ… Proper error handling and user feedback</li>
            <li>âœ… Secure data processing in views</li>
        </ul>
    </div>

    <!-- Secure form using Django ExampleForm with built-in security features -->
    <form method="post" novalidate style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
        {% csrf_token %}
        
        <!-- Display form errors if any -->
        {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {{ form.non_field_errors }}
            </div>
        {% endif %}
        
        <!-- Name field with validation -->
        <div style="margin: 15px 0;">
            <label for="{{ form.name.id_for_label }}" style="font-weight: bold;">{{ form.name.label }}:</label>
            {% if form.name.help_text %}
                <small style="color: #6c757d; display: block;">{{ form.name.help_text }}</small>
            {% endif %}
            {{ form.name }}
            {% if form.name.errors %}
                <div class="field-error" style="color: #dc3545; font-size: 0.875em; margin-top: 5px;">
                    {{ form.name.errors.0 }}
                </div>
            {% endif %}
        </div>
        
        <!-- Email field with validation -->
        <div style="margin: 15px 0;">
            <label for="{{ form.email.id_for_label }}" style="font-weight: bold;">{{ form.email.label }}:</label>
            {% if form.email.help_text %}
                <small style="color: #6c757d; display: block;">{{ form.email.help_text }}</small>
            {% endif %}
            {{ form.email }}
            {% if form.email.errors %}
                <div class="field-error" style="color: #dc3545; font-size: 0.875em; margin-top: 5px;">
                    {{ form.email.errors.0 }}
                </div>
            {% endif %}
        </div>
        
        <!-- Message field with validation -->
        <div style="margin: 15px 0;">
            <label for="{{ form.message.id_for_label }}" style="font-weight: bold;">{{ form.message.label }}:</label>
            {% if form.message.help_text %}
                <small style="color: #6c757d; display: block;">{{ form.message.help_text }}</small>
            {% endif %}
            {{ form.message }}
            {% if form.message.errors %}
                <div class="field-error" style="color: #dc3545; font-size: 0.875em; margin-top: 5px;">
                    {{ form.message.errors.0 }}
                </div>
            {% endif %}
        </div>
        
        <div style="margin: 25px 0;">
            <button type="submit" class="btn btn-primary">Submit Securely</button>
            <a href="{% url 'book_list' %}" class="btn btn-secondary">Back to Books</a>
        </div>
    </form>

    <!-- Security testing suggestions -->
    <div style="margin-top: 30px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px;">
        <h4>ðŸ§ª Try Testing Security (these should be blocked):</h4>
        <ul style="margin: 10px 0 0 20px; font-family: monospace; font-size: 0.9em;">
            <li>Name: <code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code></li>
            <li>Name: <code>&lt;img src=x onerror=alert('XSS')&gt;</code></li>
            <li>Message: <code>&lt;script&gt;document.location='http://evil.com'&lt;/script&gt;</code></li>
            <li>Name: <code>X</code> (too short)</li>
            <li>Message: <code>Hi</code> (too short)</li>
        </ul>
        <p style="margin-top: 10px; color: #856404;"><strong>Expected Result:</strong> Form should reject these inputs with helpful error messages.</p>
    </div>
</div>

<style>
.form-control {
    width: 100%;
    padding: 8px 12px;
    font-size: 14px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    transition: border-color 0.3s;
    box-sizing: border-box;
}
.form-control:focus {
    border-color: #80bdff;
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
}
textarea.form-control {
    resize: vertical;
}
.field-error {
    margin-top: 5px;
}
.alert {
    padding: 12px;
    margin-bottom: 20px;
    border: 1px solid transparent;
    border-radius: 4px;
}
.alert-danger {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
}
</style>
{% endblock %}
